# Enterprise Windows Security Dashboard & Alerting Configuration

## Overview

This guide provides a professional, scalable Windows security monitoring solution for cybersecurity companies. The dashboard and alerts are designed to be **generic and scalable** - no need to specify individual agent names/hostnames for each machine.

## Key Features

**Agent-Agnostic**: Works with any Windows machine with Wazuh agent  
**Auto-Discovery**: Automatically includes new Windows agents  
**Enterprise-Grade**: Based on 2025 threat landscape and best practices  
**MITRE ATT&CK Aligned**: Covers latest attack techniques  
**Scalable**: From single machine to enterprise fleet  

---

## Part 1: Generic Dashboard Configuration

### 1.1 Main Security Overview Dashboard

**Navigation:** `Analytics → Dashboard → Create Dashboard`

#### Dashboard Layout (Professional 6-Panel Layout):

```
┌─────────────────────────────────┬─────────────────────────────────┐
│ Real-Time Threat Activity       │ Critical Security Events        │
│ (Line Chart - Last 24h)        │ (Metric - Live Count)          │
├─────────────────────────────────┼─────────────────────────────────┤
│ Windows Agents Status           │ Top Attack Techniques           │
│ (Donut Chart)                   │ (Horizontal Bar)                │
├─────────────────────────────────┼─────────────────────────────────┤
│ Security Events by Severity     │ Recent High-Risk Activities     │
│ (Vertical Bar)                  │ (Data Table - Live Feed)       │
└─────────────────────────────────┴─────────────────────────────────┘
```

#### Panel 1: Real-Time Threat Activity
```
Visualization: Lens Line Chart
Data Source: wazuh-alerts-*
Filter: agent.os.platform: "windows" AND rule.level: >=7
X-axis: @timestamp (last 24 hours)
Y-axis: Count of events
Group by: rule.groups
```

#### Panel 2: Critical Security Events (Live Counter)
```
Visualization: Lens Metric
Data Source: wazuh-alerts-*
Filter: agent.os.platform: "windows" AND rule.level: >=12
Metric: Count
Time Range: Last 15 minutes (auto-refresh)
```

#### Panel 3: Windows Agents Status
```
Visualization: Lens Donut Chart
Data Source: wazuh-alerts-*
Filter: agent.os.platform: "windows"
Group by: agent.status
Metric: Unique count of agent.name
```

#### Panel 4: Top Attack Techniques (MITRE ATT&CK)
```
Visualization: Lens Horizontal Bar
Data Source: wazuh-alerts-*
Filter: agent.os.platform: "windows" AND rule.mitre.technique: *
X-axis: Count
Y-axis: rule.mitre.technique (top 10)
```

#### Panel 5: Security Events by Severity
```
Visualization: Lens Vertical Bar
Data Source: wazuh-alerts-*
Filter: agent.os.platform: "windows"
X-axis: rule.level
Y-axis: Count
Color by: Severity (Red: 12-16, Orange: 8-11, Yellow: 5-7, Green: 0-4)
```

#### Panel 6: Recent High-Risk Activities
```
Visualization: Data Table
Data Source: wazuh-alerts-*
Filter: agent.os.platform: "windows" AND rule.level: >=10
Columns: @timestamp, agent.name, rule.description, rule.level, data.win.eventdata.user
Sort: @timestamp (descending)
Time Range: Last 1 hour
```

---

## Part 2: Specialized Windows Monitoring Dashboards

### 2.1 PowerShell & Living-off-the-Land Dashboard

**Critical for 2025 Threat Landscape**

#### PowerShell Activity Monitor
```
Visualization: Lens Line Chart
Filter: agent.os.platform: "windows" AND data.win.eventdata.processName: "*powershell*"
Purpose: Track PowerShell execution patterns
Alert Threshold: >50 executions in 5 minutes
```

#### Encoded PowerShell Commands
```
Visualization: Data Table
Filter: agent.os.platform: "windows" AND data.win.eventdata.commandLine: "*-enc*" OR "*-EncodedCommand*"
Purpose: Detect obfuscated PowerShell attacks
Columns: @timestamp, agent.name, data.win.eventdata.commandLine, data.win.eventdata.user
```

### 2.2 Lateral Movement Detection Dashboard

#### Remote Desktop Activity
```
Filter: agent.os.platform: "windows" AND rule.id: (4624 OR 4625) AND data.win.eventdata.logonType: "10"
Purpose: Monitor RDP login attempts
```

#### WMI & Administrative Tools
```
Filter: agent.os.platform: "windows" AND data.win.eventdata.processName: ("wmic.exe" OR "sc.exe" OR "schtasks.exe" OR "winrs.exe")
Purpose: Detect lateral movement tools
```

#### Service Installation (Potential Lateral Movement)
```
Filter: agent.os.platform: "windows" AND rule.id: "7045" AND data.win.eventdata.serviceName: *
Purpose: Monitor suspicious service creation
```

### 2.3 File Integrity & Registry Monitoring

#### Critical System Files
```
Filter: agent.os.platform: "windows" AND rule.groups: "syscheck" AND syscheck.path: ("C:\\Windows\\System32\\*" OR "C:\\Windows\\SysWOW64\\*")
Purpose: Monitor critical system file changes
```

#### Registry Persistence Monitoring
```
Filter: agent.os.platform: "windows" AND rule.groups: "syscheck" AND syscheck.path: "*\\CurrentVersion\\Run*"
Purpose: Detect persistence mechanisms
```

---

## Part 3: Professional Alert Configuration

### 3.1 High-Priority Security Alerts

**Navigation:** `Stack Management → Alerts and insights → Rules → Create rule`

#### Alert 1: Critical PowerShell Activity
```json
{
  "name": "Critical PowerShell Activity - Enterprise Alert",
  "rule_type_id": ".index-threshold",
  "params": {
    "index": ["wazuh-alerts-*"],
    "timeField": "@timestamp",
    "aggType": "count",
    "threshold": [10],
    "thresholdComparator": ">",
    "timeWindowSize": 5,
    "timeWindowUnit": "m",
    "filterQuery": {
      "bool": {
        "must": [
          {"term": {"agent.os.platform": "windows"}},
          {"wildcard": {"data.win.eventdata.processName": "*powershell*"}},
          {"range": {"rule.level": {"gte": 7}}}
        ]
      }
    }
  },
  "schedule": {
    "interval": "1m"
  },
  "actions": [
    {
      "group": "threshold met",
      "params": {
        "level": "high",
        "message": "CRITICAL: Suspicious PowerShell activity detected on {{context.conditions.0.actionGroupDisplayValue}} Windows systems. Immediate investigation required."
      }
    }
  ]
}
```

#### Alert 2: Lateral Movement Detection
```json
{
  "name": "Windows Lateral Movement - Enterprise Alert",
  "rule_type_id": ".index-threshold",
  "params": {
    "index": ["wazuh-alerts-*"],
    "timeField": "@timestamp",
    "aggType": "count",
    "threshold": [5],
    "thresholdComparator": ">",
    "timeWindowSize": 10,
    "timeWindowUnit": "m",
    "filterQuery": {
      "bool": {
        "must": [
          {"term": {"agent.os.platform": "windows"}},
          {"terms": {"data.win.eventdata.processName": ["wmic.exe", "sc.exe", "schtasks.exe", "winrs.exe", "psexec.exe"]}}
        ]
      }
    }
  },
  "schedule": {
    "interval": "2m"
  }
}
```

#### Alert 3: Critical File Integrity Violations
```json
{
  "name": "Critical System File Changes - Enterprise Alert",
  "rule_type_id": ".index-threshold",
  "params": {
    "index": ["wazuh-alerts-*"],
    "timeField": "@timestamp",
    "aggType": "count",
    "threshold": [1],
    "thresholdComparator": ">=",
    "timeWindowSize": 1,
    "timeWindowUnit": "m",
    "filterQuery": {
      "bool": {
        "must": [
          {"term": {"agent.os.platform": "windows"}},
          {"term": {"rule.groups": "syscheck"}},
          {"wildcard": {"syscheck.path": "C:\\Windows\\System32\\*"}},
          {"range": {"rule.level": {"gte": 10}}}
        ]
      }
    }
  }
}
```

#### Alert 4: Persistence Mechanism Detection
```json
{
  "name": "Windows Persistence Mechanism - Enterprise Alert",
  "rule_type_id": ".index-threshold",
  "params": {
    "index": ["wazuh-alerts-*"],
    "timeField": "@timestamp",
    "aggType": "count",
    "threshold": [1],
    "thresholdComparator": ">=",
    "timeWindowSize": 5,
    "timeWindowUnit": "m",
    "filterQuery": {
      "bool": {
        "must": [
          {"term": {"agent.os.platform": "windows"}},
          {"wildcard": {"syscheck.path": "*CurrentVersion\\Run*"}}
        ]
      }
    }
  }
}
```

#### Alert 5: Suspicious Service Creation
```json
{
  "name": "Suspicious Windows Service Creation - Enterprise Alert",
  "rule_type_id": ".index-threshold",
  "params": {
    "index": ["wazuh-alerts-*"],
    "timeField": "@timestamp",
    "aggType": "count",
    "threshold": [1],
    "thresholdComparator": ">=",
    "timeWindowSize": 1,
    "timeWindowUnit": "m",
    "filterQuery": {
      "bool": {
        "must": [
          {"term": {"agent.os.platform": "windows"}},
          {"term": {"rule.id": "7045"}},
          {"bool": {
            "should": [
              {"wildcard": {"data.win.eventdata.serviceName": "*temp*"}},
              {"wildcard": {"data.win.eventdata.serviceName": "*random*"}},
              {"wildcard": {"data.win.eventdata.serviceName": "*test*"}},
              {"regexp": {"data.win.eventdata.serviceName": "[a-f0-9]{8,}"}}
            ]
          }}
        ]
      }
    }
  }
}
```

### 3.2 Medium-Priority Monitoring Alerts

#### Alert 6: RDP Brute Force Detection
```json
{
  "name": "RDP Brute Force Attempt - Enterprise Alert",
  "rule_type_id": ".index-threshold",
  "params": {
    "index": ["wazuh-alerts-*"],
    "timeField": "@timestamp",
    "aggType": "count",
    "threshold": [15],
    "thresholdComparator": ">",
    "timeWindowSize": 15,
    "timeWindowUnit": "m",
    "filterQuery": {
      "bool": {
        "must": [
          {"term": {"agent.os.platform": "windows"}},
          {"term": {"rule.id": "4625"}},
          {"term": {"data.win.eventdata.logonType": "10"}}
        ]
      }
    }
  }
}
```

---

## Part 4: Advanced Generic Filters

### 4.1 Universal Windows Security Filters

#### Master Windows Filter
```
Base Filter: agent.os.platform: "windows"
Purpose: Automatically includes all Windows agents (current and future)
```

#### Severity-Based Filters
```
Critical Events: agent.os.platform: "windows" AND rule.level: [12 TO 16]
High Events: agent.os.platform: "windows" AND rule.level: [8 TO 11]
Medium Events: agent.os.platform: "windows" AND rule.level: [5 TO 7]
Low Events: agent.os.platform: "windows" AND rule.level: [1 TO 4]
```

#### Attack Category Filters
```
PowerShell Activity: agent.os.platform: "windows" AND (data.win.eventdata.processName: "*powershell*" OR data.win.eventdata.parentProcessName: "*powershell*")

Lateral Movement: agent.os.platform: "windows" AND (rule.mitre.technique: "T1021*" OR data.win.eventdata.processName: ("wmic.exe" OR "sc.exe" OR "schtasks.exe" OR "winrs.exe" OR "psexec.exe"))

Persistence: agent.os.platform: "windows" AND (rule.mitre.technique: "T1053*" OR rule.mitre.technique: "T1547*" OR syscheck.path: "*CurrentVersion\\Run*")

Privilege Escalation: agent.os.platform: "windows" AND (rule.mitre.technique: "T1068*" OR rule.mitre.technique: "T1134*")

Defense Evasion: agent.os.platform: "windows" AND (rule.mitre.technique: "T1055*" OR rule.mitre.technique: "T1027*")
```

---

## Part 5: Custom Wazuh Rules for Enhanced Detection

### 5.1 PowerShell Obfuscation Detection

Add to `/var/ossec/etc/rules/local_rules.xml`:

```xml
<group name="powershell,windows,">
  <rule id="100001" level="12">
    <if_group>windows</if_group>
    <field name="data.win.eventdata.processName">powershell.exe|pwsh.exe</field>
    <field name="data.win.eventdata.commandLine">-enc|-EncodedCommand|-e </field>
    <description>PowerShell encoded command execution detected (Possible malicious activity)</description>
    <mitre>
      <id>T1059.001</id>
      <id>T1027</id>
    </mitre>
  </rule>

  <rule id="100002" level="10">
    <if_group>windows</if_group>
    <field name="data.win.eventdata.processName">powershell.exe|pwsh.exe</field>
    <regex>Invoke-Expression|IEX|DownloadString|DownloadFile|Net.WebClient</regex>
    <description>Suspicious PowerShell command execution detected</description>
    <mitre>
      <id>T1059.001</id>
    </mitre>
  </rule>
</group>
```

### 5.2 Lateral Movement Detection Rules

```xml
<group name="lateral_movement,windows,">
  <rule id="100010" level="11">
    <if_group>windows</if_group>
    <field name="data.win.eventdata.processName">wmic.exe</field>
    <field name="data.win.eventdata.commandLine">process call create</field>
    <description>WMI lateral movement attempt detected</description>
    <mitre>
      <id>T1021.002</id>
    </mitre>
  </rule>

  <rule id="100011" level="11">
    <if_group>windows</if_group>
    <field name="data.win.eventdata.processName">sc.exe</field>
    <field name="data.win.eventdata.commandLine">\\\\.*create</field>
    <description>Remote service creation detected (Possible lateral movement)</description>
    <mitre>
      <id>T1021.002</id>
    </mitre>
  </rule>
</group>
```

### 5.3 Persistence Detection Rules

```xml
<group name="persistence,windows,">
  <rule id="100020" level="10">
    <if_group>syscheck</if_group>
    <field name="syscheck.path">\\CurrentVersion\\Run</field>
    <description>Registry Run key modification detected (Possible persistence mechanism)</description>
    <mitre>
      <id>T1547.001</id>
    </mitre>
  </rule>

  <rule id="100021" level="12">
    <if_group>windows</if_group>
    <field name="data.win.eventdata.eventID">7045</field>
    <regex>temp|random|test|[a-f0-9]{8,}</regex>
    <description>Suspicious service name detected (Possible malware persistence)</description>
    <mitre>
      <id>T1543.003</id>
    </mitre>
  </rule>
</group>
```

---

## Part 6: Professional Notification Setup

### 6.1 Email Alert Configuration

Configure in `/var/ossec/etc/ossec.conf`:

```xml
<ossec_config>
  <global>
    <email_notification>yes</email_notification>
    <email_to>security-team@yourcompany.com</email_to>
    <smtp_server>smtp.yourcompany.com</smtp_server>
    <email_from>wazuh-alerts@yourcompany.com</email_from>
    <email_reply_to>noreply@yourcompany.com</email_reply_to>
  </global>

  <alerts>
    <log_alert_level>3</log_alert_level>
    <email_alert_level>10</email_alert_level>
  </alerts>

  <!-- High Priority Alerts -->
  <email_alerts>
    <email_to>soc-critical@yourcompany.com</email_to>
    <level>12</level>
    <group>windows</group>
    <format>full</format>
  </email_alerts>

  <!-- PowerShell Specific Alerts -->
  <email_alerts>
    <email_to>powershell-alerts@yourcompany.com</email_to>
    <rule_id>100001,100002</rule_id>
    <format>full</format>
  </email_alerts>

  <!-- Lateral Movement Alerts -->
  <email_alerts>
    <email_to>incident-response@yourcompany.com</email_to>
    <rule_id>100010,100011</rule_id>
    <format>full</format>
  </email_alerts>
</ossec_config>
```

---

## Part 7: Implementation Checklist

### Dashboard Setup
-  Create main security overview dashboard (6 panels)
-  Configure PowerShell monitoring dashboard
-  Set up lateral movement detection dashboard
-  Create file integrity monitoring dashboard
-  Configure auto-refresh intervals (1-5 minutes)

### Alert Configuration
-  Critical PowerShell activity alert (5 min threshold)
-  Lateral movement detection alert (10 min threshold)
-  File integrity violation alert (immediate)
-  Persistence mechanism alert (5 min threshold)
-  Suspicious service creation alert (immediate)
-  RDP brute force alert (15 min threshold)

### Custom Rules Implementation
-  Add PowerShell obfuscation detection rules
-  Implement lateral movement detection rules
-  Configure persistence detection rules
-  Test rules with `/var/ossec/bin/wazuh-logtest`
-  Restart Wazuh manager after rule deployment

### Notification Setup
-  Configure email alerts for different severity levels
-  Set up team-specific alert routing
-  Test email delivery
-  Configure Slack/Teams integration (optional)

---

## Part 8: Scalability & Maintenance

### 8.1 Agent Auto-Discovery
The dashboard automatically detects:
-  New Windows agents (no configuration needed)
-  Agent status changes
-  New threat patterns
-  Updated MITRE ATT&CK techniques

### 8.2 Performance Optimization
```
Index Management: Set retention policy for wazuh-alerts-* (30-90 days)
Query Optimization: Use time-based filters to improve performance
Resource Monitoring: Monitor Elasticsearch cluster performance
Alert Tuning: Adjust thresholds based on environment baseline
```

### 8.3 Quarterly Updates
- Review and update threat patterns
- Adjust alert thresholds based on false positive rates
- Update MITRE ATT&CK technique mappings
- Add new visualization panels for emerging threats

---

## Conclusion

This enterprise-grade Windows security monitoring solution provides:

**Comprehensive Coverage**: All major Windows attack vectors  
**Professional Dashboards**: SOC-ready visualizations  
**Intelligent Alerting**: Tuned for minimal false positives  
**Scalable Architecture**: From 1 to 10,000+ Windows endpoints  
**Threat-Informed**: Based on 2025 threat landscape  
🔄 **Future-Proof**: Generic filters work with new agents automatically  

**No agent names or hostnames needed** - everything is based on `agent.os.platform: "windows"` for maximum scalability and automation.
